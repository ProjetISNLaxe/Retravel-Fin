import pygame, random, sysfrom pygame.locals import *from menu.imageinterfacetoload import testrect, alphabet, policefrom battle.combatV3 import tourpartourimport osfrom menu.dialogue import jeanmadiaimport Runner.Principalfrom respawn import respawnwith open("options\\fullscreen", "r") as fullscreen:    fullscreenread = fullscreen.read()if fullscreenread == "0":    fenetre = pygame.display.set_mode((800, 600))else:    fenetre = pygame.display.set_mode((800, 600), FULLSCREEN)def quetes():    activefich = open("menu/quetes/active", "r")    active = activefich.read()    activefich.close()    phase1fi = open("save1/histoire/phase1", "r")    phase1 = bool(int(phase1fi.read()))    phase1fi.close()    phase2fi = open("save1/histoire/phase2", "r")    phase2 = bool(int(phase2fi.read()))    phase2fi.close()    phase3fi = open("save1/histoire/phase3", "r")    phase3 = bool(int(phase3fi.read()))    phase3fi.close()    phase4fi = open("save1/histoire/phase4", "r")    phase4 = bool(int(phase4fi.read()))    phase4fi.close()    phase5fi = open("save1/histoire/phase5", "r")    phase5 = bool(int(phase5fi.read()))    phase5fi.close()    phase6fi = open("save1/histoire/phase6", "r")    phase6 = bool(int(phase6fi.read()))    phase6fi.close()    if active == "marie":        marie()    if active == "patrick":        patrick()    if active == "jeanma":        if phase1:            jeanma()        if phase2:            visitintend()        if phase3:            fjordglas()        if phase4:            voleur()        if phase5:            fjordglas2()        if phase6:            chateau()def deleteactive(pnj):    todo = open("menu/quetes/liste", "r")    todoli = todo.read().split(",")    todo.close()    todoli.remove(pnj)    for i in range(len(todoli) - 1):        todoli[i] += ","    todostr = ""    for i in range(len(todoli)):        todostr += todoli[i]    todo = open("menu/quetes/liste", "w")    todo.write(todostr)    todo.close()    activefich = open("menu/quetes/active", "w")    activefich.write("")    activefich.close()def delete(pnj):    todo = open("menu/quetes/liste", "r")    todoli = todo.read().split(",")    todo.close()    todoli.remove(pnj)    for i in range(len(todoli) - 1):        todoli[i] += ","    todostr = ""    for i in range(len(todoli)):        todostr += todoli[i]    todo = open("menu/quetes/liste", "w")    todo.write(todostr)    todo.close()    activefich = open("menu/quetes/active", "w")    activefich.write("")    activefich.close()    todo = open("menu/quetes/quetedispo", "r")    todoli = todo.read().split(",")    todo.close()    todoli.remove(pnj)    for i in range(len(todoli) - 1):        todoli[i] += ","    todostr = ""    for i in range(len(todoli)):        todostr += todoli[i]    todo = open("menu/quetes/quetedispo", "w")    todo.write(todostr)    todo.close()def win(pnj, fenetre):    """Fonction qui permet l'affichage des dialogues pnj perso"""    clock = pygame.time.Clock()    dialoguequete = pygame.image.load("menu/quetes/HUD/boitedialogue.png").convert_alpha()    winfi = open("menu/quetes/" + pnj + "/win", "r")    winstr = winfi.read()  # On ouvre une liste dans un fichier contenant divers dialogues possibles    winfi.close()    imagepnj = pygame.image.load("menu/pnj/" + pnj + "/" + pnj + "_tall.png").convert_alpha()  # image du pnj à droite    bouton2 = pygame.image.load("menu/quetes/HUD/boutonretour.png").convert_alpha()    bouton2rect = bouton2.get_rect()    bouton2rect.x = 420    bouton2rect.y = 545    quetedispof = open("menu/quetes/quetedispo", "r")    quetedispo = quetedispof.read().split(",")  # On ouvre le fichier de sauvegarde contenant les quêtes disponibles    quetedispof.close()    quetefi = open("menu/quetes/active", "r")    queteactive = quetefi.read()  # Quete active    quetefi.close()    taillepnj = imagepnj.get_size()    x = 0    tobreak = False    text = winstr    i = 0    while 1:        for event in pygame.event.get():            if event.type == QUIT:                pygame.quit()                exit()            if event.type == KEYDOWN:                if event.key == K_ESCAPE:                    return            if event.type == MOUSEMOTION:                if event.type == MOUSEMOTION:                    testrect.x = event.pos[0]                    testrect.y = event.pos[1]            if event.type == MOUSEBUTTONDOWN:                if event.button == 1:                    if testrect.colliderect(bouton2rect):                        return        tobreak = False  # Pour casser une boucle        fenetre.blit(dialoguequete, (0, 374))        dialoguequete = pygame.image.load("menu/quetes/HUD/boitedialogue.png").convert_alpha()        fenetre.blit(imagepnj, (10, 540 - taillepnj[1]))        fenetre.blit(bouton2, bouton2rect)        if len(text) > 65:  # Si le texte sort du cadre            affich = []  # liste des lignes à afficher            k = 0  # increment            motablit = text.split(" ")  # On crée un liste avec tout les mots            for i in range(int(len(text) / 65) + 3):                affich.append("")                while len(affich[i]) < 65:  # On rajoute des mots                    if k < len(motablit) - 1:  # sauf si le nombre de caractère sort du cadre                        if len(affich[i] + motablit[k] + " ") < 65:                            affich[i] += motablit[k] + " "                        else:                            break                        k += 1                    else:                        break            if motablit[-1] not in affich[-1]:  # Si le dernier mot est décalé on le reblit dans la dernière phrase                for i in range(len(alphabet)):                    for j in range(len(affich)):                        if alphabet[i] not in affich[j]:                            affich[j] += motablit[-1]                            tobreak = True                            break                    if tobreak:                        break            if len(affich) <= 10:  # Si on sort pas du cadre horizontale                for i in range(len(affich)):  # blit normal                    dialoguequete.blit(police.render(affich[i], True, (32, 153, 152)), (175, 10 + 15 * i))            else:  # sinon on crée un curseur                tkey = pygame.key.get_pressed()                if tkey[K_UP] and x + 374 + 15 * len(affich) + 25 > 550:                    x -= 7.5                    dialoguequete = pygame.image.load("menu/quetes/HUD/boitedialogue.png").convert_alpha()                elif tkey[K_DOWN] and 384 + x + 10 <= 384:                    x += 7.5                    dialoguequete = pygame.image.load("menu/quetes/HUD/boitedialogue.png").convert_alpha()                for i in range(len(affich)):                    if x + 384 + 15 * i < 530:                        dialoguequete.blit(police.render(affich[i], True, (32, 153, 152)), (175, x + 10 + 15 * i))        if len(text) < 65:            dialoguequete.blit(police.render(text, True, (32, 153, 152)), (175, 10 + 15 * i))        clock.tick(60)  # 60 FPS        pygame.display.flip()def gagneror(nbr):    orfi = open("save1/invent/cpic", "r")  # nombre d'or    nbror = int(orfi.read())    orfi.close()    nbror += nbr    orfi = open("save1/invent/cpic", "w")  # nombre d'or    orfi.write(str(nbror))    orfi.close()def reset():    todo = open("menu/quetes/quetedispo", "w")    todo.write("jeanma,marie,dragon,patrick")    todo.close()    todo = open("menu/quetes/liste", "w")    todo.write("jeanma")    todo.close()    todo = open("menu/quetes/active", "w")    todo.write("jeanma")    todo.close()    jeanmafi = open("menu/quetes/jeanma/jeanma", "w")    jeanmafi.write("0")    jeanmafi.close()    activefich = open("menu/quetes/pnjrencontre", "w")    activefich.write("")    activefich.close()    loupfi = open("menu/quetes/jeanma/loup", "w")    loupfi.write("0")    loupfi.close()    traveli = open("save1/histoire/transibateau", "w")    traveli.write("0")    traveli.close()    phase1fi = open("save1/histoire/phase1", "w")    phase1fi.write("1")    phase1fi.close()    phase2fi = open("save1/histoire/phase2", "w")    phase2fi.write("0")    phase2fi.close()    phase3fi = open("save1/histoire/phase3", "w")    phase3fi.write("0")    phase3fi.close()    phase4fi = open("save1/histoire/phase4", "w")    phase4fi.write("0")    phase4fi.close()    phase5fi = open("save1/histoire/phase5", "w")    phase5fi.write("0")    phase5fi.close()    phase6fi = open("save1/histoire/phase6", "w")    phase6fi.write("0")    phase6fi.close()    capitalefi = open("menu/quetes/jeanma/capitale", "w")    capitalefi.write("0")    capitalefi.close()    gardesfi = open("save1/histoire/gardes", "w")    gardesfi.write("0")    gardesfi.close()    toprintfi = open("menu/quetes/jeanma/toprint", "w")    toprintfi.write("Explorez les environs")    toprintfi.close()    posmap = os.listdir("save1/posmap")    for i in range (len(posmap)):        with open("save1/posmap/"+posmap[i], "w") as posmapfi:            posmapfi.write("")    pospeso = os.listdir("save1/pospeso")    for i in range(len(pospeso)):        with open("save1/pospeso/" + pospeso[i], "w") as pospesofi:            pospesofi.write("")    lieufi = open("save1/map", 'w')    lieufi.write("mapdepart")    lieufi.close()    orfi = open("save1/invent/cpic", "w")  # nombre d'or    orfi.write("0")    orfi.close()    with open("menu/quetes/jeanma/vol", "w") as jeanmavol:        jeanmavol.write("0")    with open("menu/quetes/jeanma/diamaison_2", "w") as diamaison2:        diamaison2.write("0")    with open("save1/tuto", "w") as tuto:        tuto.write("0")    with open("save1/save", "w") as shooter:        shooter.write("0")    with open("save1/runner", "w") as runner:        runner.write("0")    with open("save1/inventaire", "w") as inventaire:        inventaire.write("pomme,nbsoin,mana")    with open("save1/objet/pomme", "w") as pomme:        pomme.write("10")    with open("save1/objet/nbsoin", "w") as nbsoin:        nbsoin.write("10")def marie():    activefich = open("menu/quetes/pnjrencontre", "r")    active = activefich.read()    activefich.close()    if active == "patrick":        pygame.image.save(fenetre, "menu/inventory/fond.jpg")        activefich = open("menu/quetes/pnjrencontre", "w")        activefich.write("")        activefich.close()        delete("marie")        win("marie", fenetre)def patrick():    activefich = open("menu/quetes/pnjrencontre", "r")    active = activefich.read()    activefich.close()    litransifi = open("menu/quetes/visitelieu", "r")    lieu = litransifi.read()    litransifi.close()    if active == "marie":        delete("patrick")        win("patrick", fenetre)def jeanma():    rencontrefi = open("menu/quetes/pnjrencontre", "r")    rencontre = rencontrefi.read()    rencontrefi.close()    mobfi = open("menu/quetes/mobmort", "r")    mob = mobfi.read()    mobfi.close()    jeanmafi = open("menu/quetes/jeanma/jeanma", "r")    jeanma = jeanmafi.read()    jeanmafi.close()    loupfi = open("menu/quetes/jeanma/loup", "r")    loup = loupfi.read()    loupfi.close()    if rencontre == "jeanma" and jeanma != "1":        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Sauvez-le ou vous serez chatié")        toprintfi.close()        jeanmafi = open("menu/quetes/jeanma/jeanma", "w")        jeanmafi.write("1")        jeanmafi.close()    if jeanma == "1" and mob == "loup" and loup != "1":        etat = tourpartour()        mobfi = open("menu/quetes/mobmort", "w")        mobfi.write("")        mobfi.close()        if etat == "victoire":            jeanmadia("Suivez-moi !")            loupfi = open("menu/quetes/jeanma/loup", "w")            loupfi.write("1")            loupfi.close()            toprintfi = open("menu/quetes/jeanma/toprint", "w")            toprintfi.write("Suivez l'inconnu")            toprintfi.close()            traveli = open("save1/histoire/transibateau", "w")            traveli.write("1")            traveli.close()            phase1fi = open("save1/histoire/phase1", "w")            phase1fi.write("0")            phase1fi.close()            phase2fi = open("save1/histoire/phase2", "w")            phase2fi.write("1")            phase2fi.close()            gagneror(10)    if loup == "1":        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Suivez l'inconnu")        toprintfi.close()def visitintend():    myfont = pygame.font.SysFont("monospace", 20)    lieufi = open("save1/map", 'r')    lieu = lieufi.read()    lieufi.close()    capitalefi = open("menu/quetes/jeanma/capitale", "r")    capitale = bool(int(capitalefi.read()))    capitalefi.close()    if lieu == "capitale" and not capitale:        jeanmadia("Il faut aller au château !")        fenetre.blit(myfont.render("CHARGEMENT...", False, (1, 44, 166)), (500, 50))        fenetre.fill((0,0,0))        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Allez au chateau pour rencontrer l'intendant")        toprintfi.close()        capitalefi = open("menu/quetes/jeanma/capitale", "w")        capitalefi.write("1")        capitalefi.close()    if "chateau" in lieu:        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Allez rencontrer l'intendant au deuxième étage")        toprintfi.close()        if lieu == "chateau_2F":            toprintfi = open("menu/quetes/jeanma/toprint", "w")            toprintfi.write("Il semblerait qu'il soit en train de manger...")            toprintfi.close()            rencontrefi = open("menu/quetes/pnjrencontre", "r")            rencontre = rencontrefi.read()            rencontrefi.close()            if rencontre == "intendant":                jeanmadia("Allez à fjordglas, battez le Malarich !", "retour", "intendant" )                phase2fi = open("save1/histoire/phase2", "w")                phase2fi.write("0")                phase2fi.close()                phase3fi = open("save1/histoire/phase3", "w")                phase3fi.write("1")                phase3fi.close()                fjordglas()def fjordglas():    lieufi = open("save1/map", 'r')    lieu = lieufi.read()    lieufi.close()    toprintfi = open("menu/quetes/jeanma/toprint", "w")    toprintfi.write("Allez à FjordGlas")    toprintfi.close()    with open("save1/histoire/gardes", "r") as gardesverif:        gardesverif = bool(int(gardesverif.read()))    with open("menu/quetes/mobmort", "r") as mobmort:        mobmort = mobmort.read()    if lieu == "cheminfjord":        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Rencontrer les gardes")        toprintfi.close()    with open("save1/histoire/gardes", "r") as gardesverif:        gardesverif = bool(int(gardesverif.read()))    with open("menu/quetes/mobmort", "r") as mobmort:        mobmort = mobmort.read()    if mobmort == "soldat":        with open("save1/histoire/gardes", "w") as gardes:            gardes.write("1")    with open("save1/histoire/gardes", "r") as gardesverif:        gardesverif = bool(int(gardesverif.read()))    with open("menu/quetes/mobmort", "r") as mobmort:        mobmort = mobmort.read()    if gardesverif:        with open("save1/histoire/phase3", "w") as phase3:            phase3.write("0")        with open("save1/histoire/phase4", "w") as phase4:            phase4.write("1")        voleur()def voleur():    lieufi = open("save1/map", 'r')    lieu = lieufi.read()    lieufi.close()    with open("menu/quetes/jeanma/toprint", "w") as toprintfi:        toprintfi.write("Cherchez de l'aide")    if lieu == "capitale":        with open("menu/quetes/jeanma/toprint", "w") as toprintfi:            toprintfi.write("Retrouvez le voleur !")    if "guilde" in lieu:        with open("menu/quetes/jeanma/toprint", "w") as toprintfi:            toprintfi.write("Cherchez un moyen de descendre a la salle du butin")    if lieu == "butin":        with open("menu/quetes/jeanma/toprint", "w") as toprintfi:            toprintfi.write("Cherchez un moyen de descendre a la salle du butin")        with open("menu/quetes/mobmort", "r") as mob:           mob = mob.read()        if mob == "sinatramechante":            etat = tourpartour()            if etat == "victoire":                jeanmadia("Vous pouvez récupérer votre dû", "suivant", "sinatra")                jeanmadia("Je vous dois un service", "suivant", "sinatra")                jeanmadia("Je vais vous suivre et vous aider", "suivant", "sinatra")                jeanmadia("Nous aurons plus de chance contre ces gardes")                with open("save1/histoire/phase3", "w") as phase4:                    phase4.write("0")                with open("save1/histoire/phase4", "w") as phase5:                    phase5.write("1")                with open("save1/activation/perso3", "w") as perso3:                    perso3.write("1")                fjordglas2()def fjordglas2():    lieufi = open("save1/map", 'r')    lieu = lieufi.read()    lieufi.close()    toprintfi = open("menu/quetes/jeanma/toprint", "w")    toprintfi.write("Allez à FjordGlas")    toprintfi.close()    if lieu == "cheminfjord":        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Rentrez dans le donjon")        toprintfi.close()    if "fjordglas" in lieu:        with open("save1/activation/perso3", "r") as sinatra:            sinatra = bool(int(sinatra.read()))        if not sinatra:            jeanmadia("Qui etes vous ?", "suivant")            jeanmadia("Le roi m'a demandé de vous venir en aide !", "suivant", "sinatra")            jeanmadia("La grotte est infesté de bestiole...", "retour", "sinatra")        with open("save1/activation/perso3", "w") as sinatra:            sinatra.write("1")        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Cherchez un moyen de monter à l'étage")        toprintfi.close()        if lieu == "fjordglas1":            toprintfi = open("menu/quetes/jeanma/toprint", "w")            toprintfi.write("Vaincre le Malarich")            toprintfi.close()            with open("menu/quetes/mobmort", "r") as malarich:                malarich = malarich.read()            if malarich == "malarich":                pygame.mixer.music.load("son/Sound/malarich.mp3")                pygame.mixer.music.play(-1)                etat=tourpartour()                pygame.mixer.music.load("son/Sound/fjordglas.mp3")                pygame.mixer.music.play(-1)            if etat == "victoire":                jeanmadia("Wow !", "suivant")                jeanmadia("Super !", "retour", "sinatra")                phase5fi = open("save1/histoire/phase5", "w")                phase5fi.write("0")                phase5fi.close()                phase6fi = open("save1/histoire/phase6", "w")                phase6fi.write("1")                phase6fi.close()                chateau()def chateau():    toprintfi = open("menu/quetes/jeanma/toprint", "w")    toprintfi.write("Retournez au Chateau")    toprintfi.close()    lieufi = open("save1/map", 'r')    lieu = lieufi.read()    lieufi.close()    if "chateau" in lieu:        toprintfi = open("menu/quetes/jeanma/toprint", "w")        toprintfi.write("Montez au dernier étage")        toprintfi.close()        if lieu == "chateau_3F":            toprintfi = open("menu/quetes/jeanma/toprint", "w")            toprintfi.write("Rencontrez le Roi")            toprintfi.close()            activefich = open("menu/quetes/pnjrencontre", "r")            active = activefich.read()            activefich.close()            if active =="roi":                with open("save1/runner", "w") as runner:                    runner.write("1")                jeanmadia("Qu'est-ce que ....", "suivant", "joueur")                jeanmadia("Où sont passé David et Sinatra ?", "suivant", "joueur")                jeanmadia("Qui-sont ces gens ?", "suivant", "joueur")                jeanmadia("Fuyez Pauvre Fou !!!!!")                pygame.mixer.music.stop()                pygame.mixer.music.set_volume(1)                delete("jeanma")                respawn()                g = Runner.Principal.Jeu()                while g.running:                    g.new()                    g.game_over_screen()                pygame.quit()                sys.exit()